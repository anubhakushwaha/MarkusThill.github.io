<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<!--<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>-->
<!--<script type="text/x-mathjax-config">MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });</script>-->
<head>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
  function resizeIframe(obj) {
    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
  }
</script>

<meta charset="utf-8">
<title>Euler's Number and its Relationship to Random Forests &#8211; ML & Stats</title>
<meta name="description" content="Often one has to consider the problem where a sample has to be drawn of a set containing n elements, where the sample also has the size. For instance Random Forests sample the training data n times with replacement for each decision tree. One question arises in this case How many unique training examples can we expect in the sample? Since we sample with replacement, several examples will be drawn twice most likely. To calculate the expected number of unique examples, one can proceed as follows. First we define a random Variable Xi which defines the events Example i was (Xi 1) or  was not (Xi 0) selected by the sampling process. Based on the probability of these events, we can formulate an expected value for each individual which shows how many times an example is selected on average">
<meta name="keywords" content="">



<!-- Open Graph -->
<meta property="og:locale" content="en">
<meta property="og:type" content="article">
<meta property="og:title" content="Euler's Number and its Relationship to Random Forests">
<meta property="og:description" content="Often one has to consider the problem where a sample has to be drawn of a set containing n elements, where the sample also has the size. For instance Random Forests sample the training data n times with replacement for each decision tree. One question arises in this case How many unique training examples can we expect in the sample? Since we sample with replacement, several examples will be drawn twice most likely. To calculate the expected number of unique examples, one can proceed as follows. First we define a random Variable Xi which defines the events Example i was (Xi 1) or  was not (Xi 0) selected by the sampling process. Based on the probability of these events, we can formulate an expected value for each individual which shows how many times an example is selected on average">
<meta property="og:url" content="https://MarkusThill.github.io/stats/ml/gsampling-with-replacement-random-forest/">
<meta property="og:site_name" content="ML & Stats">
<meta property="og:image" content="https://MarkusThill.github.io/images/177s.jpg">






<link rel="canonical" href="https://MarkusThill.github.io/stats/ml/gsampling-with-replacement-random-forest/">
<link href="https://MarkusThill.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="ML & Stats Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

<!-- For all browsers -->
<link rel="stylesheet" href="https://MarkusThill.github.io/assets/css/main.css">
<link rel="stylesheet" href="https://MarkusThill.github.io/assets/css/jquery.mmenu.all.css">
<link rel="stylesheet" href="https://MarkusThill.github.io/assets/css/jquery.floating-social-share.min.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script type="text/javascript" src="https://MarkusThill.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://MarkusThill.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://MarkusThill.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://MarkusThill.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://MarkusThill.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://MarkusThill.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://MarkusThill.github.io/images/apple-touch-icon-144x144-precomposed.png">




<!--<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/dreampulse/computer-modern-web-font/master/fonts.css">-->
<link rel="stylesheet" href="/fonts/cmun-serif.css"></link>

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Euler’s Number and its Relationship to Random Forests | ML &amp; Stats</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="Euler’s Number and its Relationship to Random Forests" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Often one has to consider the problem where a sample has to be drawn of a set containing n elements, where the sample also has the size. For instance Random Forests sample the training data n times with replacement for each decision tree. One question arises in this case How many unique training examples can we expect in the sample? Since we sample with replacement, several examples will be drawn twice most likely. To calculate the expected number of unique examples, one can proceed as follows. First we define a random Variable Xi which defines the events Example i was (Xi 1) or was not (Xi 0) selected by the sampling process. Based on the probability of these events, we can formulate an expected value for each individual which shows how many times an example is selected on average" />
<meta property="og:description" content="Often one has to consider the problem where a sample has to be drawn of a set containing n elements, where the sample also has the size. For instance Random Forests sample the training data n times with replacement for each decision tree. One question arises in this case How many unique training examples can we expect in the sample? Since we sample with replacement, several examples will be drawn twice most likely. To calculate the expected number of unique examples, one can proceed as follows. First we define a random Variable Xi which defines the events Example i was (Xi 1) or was not (Xi 0) selected by the sampling process. Based on the probability of these events, we can formulate an expected value for each individual which shows how many times an example is selected on average" />
<link rel="canonical" href="https://markusthill.github.io/stats/ml/gsampling-with-replacement-random-forest/" />
<meta property="og:url" content="https://markusthill.github.io/stats/ml/gsampling-with-replacement-random-forest/" />
<meta property="og:site_name" content="ML &amp; Stats" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-09-07T19:37:32+02:00" />
<script type="application/ld+json">
{"description":"Often one has to consider the problem where a sample has to be drawn of a set containing n elements, where the sample also has the size. For instance Random Forests sample the training data n times with replacement for each decision tree. One question arises in this case How many unique training examples can we expect in the sample? Since we sample with replacement, several examples will be drawn twice most likely. To calculate the expected number of unique examples, one can proceed as follows. First we define a random Variable Xi which defines the events Example i was (Xi 1) or was not (Xi 0) selected by the sampling process. Based on the probability of these events, we can formulate an expected value for each individual which shows how many times an example is selected on average","headline":"Euler’s Number and its Relationship to Random Forests","dateModified":"2017-09-07T19:37:32+02:00","datePublished":"2017-09-07T19:37:32+02:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://markusthill.github.io/stats/ml/gsampling-with-replacement-random-forest/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://markusthill.github.io/images/logo.png"}},"url":"https://markusthill.github.io/stats/ml/gsampling-with-replacement-random-forest/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="https://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->



<div class="header-menu header-menu-top">
    <ul class="header-item-container">
      <li class="header-item-title header-toggle "><a href="#menu"><h2><i class="fa fa-bars"></i></h2></a></li>
      <li class="header-item-title">
        <a href="https://MarkusThill.github.io/">
          
            <img class="logo" src="https://MarkusThill.github.io/images/logo.png" alt="ML & Stats">
          
          <a href="https://MarkusThill.github.io/" class="title"> ML & Stats</a>
        </a>
      </li>
      
        
        

        
            
                <li class="header-item "><a href="https://MarkusThill.github.io/posts"><h3>Posts</h3></a></li>
            
        
      
        
        

        
          <li class="header-item "><a href="https://MarkusThill.github.io/categories"><h3>Categories</h3></a>
            <ul class="header-submenu">
              
                
                  <li class="sub-item"><a href="https://MarkusThill.github.io/categories/#Electronics">Electronics</a></li>
              
                
                  <li class="sub-item"><a href="https://MarkusThill.github.io/categories/#ML">ML</a></li>
              
                
                  <li class="sub-item"><a href="https://MarkusThill.github.io/categories/#Math">Math</a></li>
              
                
                  <li class="sub-item"><a href="https://MarkusThill.github.io/categories/#Programming">Programming</a></li>
              
                
                  <li class="sub-item"><a href="https://MarkusThill.github.io/categories/#Stats">Stats</a></li>
              
                
                  <li class="sub-item"><a href="https://MarkusThill.github.io/categories/#Template">Template</a></li>
              
                
                  <li class="sub-item"><a href="https://MarkusThill.github.io/categories/#Vector Algebra">Vector Algebra</a></li>
              
            </ul>
          </li>
        
      
        
        

        
            
                <li class="header-item "><a href="https://MarkusThill.github.io/tags"><h3>Tags</h3></a></li>
            
        
      
        
        

        
            
                <li class="header-item "><a href="https://MarkusThill.github.io/markus"><h3>About</h3></a></li>
            
        
      
        
        

        
            
                <li class="header-item "><a href="https://MarkusThill.github.io/"><h3>Home</h3></a></li>
            
        
      
      <li class="header-item"><a href="https://MarkusThill.github.io/search"><h3><i class="fa fa-search"></i></h3></a></li>
    </ul>
  </div>
<div class="entry-header">
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Euler's Number and its Relationship to Random Forests</h1>
      
        <h2><span class="entry-date date published updated"><time datetime="2017-09-07T19:37:32+02:00">September 07, 2017</time></span></h2>
      

      
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~4 minutes
        </p><!-- /.entry-reading-time -->
      
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->


<nav id="menu" style="display: none">
  <ul>
    
      
        <li><a href="https://MarkusThill.github.io/"><h3>Home</h3></a></li>
      
    
      
        <li><a href="https://MarkusThill.github.io/markus"><h3>About</h3></a></li>
      
    
      
        <li><a href="https://MarkusThill.github.io/tags"><h3>Tags</h3></a></li>
      
    
      
        <li><a href="https://MarkusThill.github.io/categories"><h3>Categories</h3></a>
          <ul>
            
              
                <li><a href="https://MarkusThill.github.io/categories/#Electronics">Electronics</a></li>
            
              
                <li><a href="https://MarkusThill.github.io/categories/#ML">ML</a></li>
            
              
                <li><a href="https://MarkusThill.github.io/categories/#Math">Math</a></li>
            
              
                <li><a href="https://MarkusThill.github.io/categories/#Programming">Programming</a></li>
            
              
                <li><a href="https://MarkusThill.github.io/categories/#Stats">Stats</a></li>
            
              
                <li><a href="https://MarkusThill.github.io/categories/#Template">Template</a></li>
            
              
                <li><a href="https://MarkusThill.github.io/categories/#Vector Algebra">Vector Algebra</a></li>
            
          </ul>
        </li>
      
    
      
        <li><a href="https://MarkusThill.github.io/posts"><h3>Posts</h3></a></li>
      
    
  </ul>
</nav>




<div id="main" role="main">
  <article class="hentry">
    <div class="entry-content">
        
            <div class="entry-image-index">
              <img src="https://MarkusThill.github.io/images/177s.jpg" alt="Euler's Number and its Relationship to Random Forests">
              <div class="image-credit">Image source: <a target="_blank" href="https://www.freepik.com">Designed by osaba / Freepik</a></div><!-- /.image-credit -->
            </div>
        
      <h1 class="post-title entry-title">Euler's Number and its Relationship to Random Forests</h1>
      <p>Consider the following problem: We have a bowl containing <script type="math/tex">n</script> different balls, all labeled with a unique number. We randomly pick a ball from the bowl, note its number and then put the ball back into the bowl. The order in which the balls are picked is not relevant. In total, <script type="math/tex">k</script> balls are picked in the same way. In combinatorics this problem is typically referred to as combinations with repetition (or sampling with replacement).
The number of possible samples which can be drawn from the bowl is:</p>

<script type="math/tex; mode=display">\binom{n+k-1}{k}</script>

<p>One particular problem arises when we choose <script type="math/tex">n=k</script>, hence, from a set of <script type="math/tex">n</script> unique elements we randomly draw a sample of size <script type="math/tex">n</script> (always putting the elements back into the set again).
The image below illustrates the problem. On the left side of the figure we have a set of four unique elements. Several possible samples with <script type="math/tex">k=n</script> drawn from this set are shown on the right side of the arrow. In total, actually 35 possible combinations exist, using the above formula.<br />
<img src="https://MarkusThill.github.io/images/samplereplace.jpg" alt="Picture description" class="image-center" /></p>

<p>But where is Euler’s number in this problem and what does this have to do with random forests, as suggested by the title of this blog post?</p>

<!--more-->

<p>I stumbled across this problem some time ago, when I was looking at the training process of random forests (RF). Most random forest implementations sample the training data (with <script type="math/tex">n</script> training examples) <script type="math/tex">n</script> times with replacement for each decision tree. I was thinking about one (actually simple) question which arises in this case: How many unique training examples can we expect in each sample? Since we sample with replacement, most likely several examples will be drawn twice. So the probability to receive a sample with all <script type="math/tex">n</script> unique elements is comparably small (assuming a sufficiently large training set). To be precise, the probability is actually <script type="math/tex">\frac{n!}{n^n}</script>. At the same time, a sample containing only one unique element has an even smaller probability of <script type="math/tex">n\Big(\frac{1}{n}\Big)^n = n^{-(n-1)}</script>. Intuitively, one could expect that around 50% of all training examples might appear in the sample. As we will see in the following, this number is actually slightly higher.
To get a first impression, we can run a simple simulation in R.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># How often do we want to repeat the simulation?</span><span class="w">
</span><span class="n">nSimulations</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">

</span><span class="n">runSimulation</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># Function that draws a sample of size n from a set of n values</span><span class="w">
  </span><span class="c1"># and returns the fraction of unique values within the sample</span><span class="w">
  </span><span class="n">sampleWithRep</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># sample the set n times with replacement</span><span class="w">
    </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">

    </span><span class="c1"># compute the fraction of unique values in this sample</span><span class="w">
    </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="c1"># Run simulation many times and print the mean value for the</span><span class="w">
  </span><span class="c1"># fraction of unique values within all simulated samples</span><span class="w">
  </span><span class="n">mean</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">nSimulations</span><span class="p">),</span><span class="w"> </span><span class="n">sampleWithRep</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Sufficiently large set</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="s2">"On average, each sample contained"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">runSimulation</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100.0</span><span class="p">),</span><span class="w">
    </span><span class="s2">"% of the values of the original set."</span><span class="p">)</span></code></pre></figure>

<!--- %* -->
<p>The above R-script should give you a value of approx. 63%, which indicates, that (for a sufficiently large training set, e.g. <script type="math/tex">n=10\,000</script>) roughly around 2/3 of the original training examples will appear in the sample. To show that this value of around 63% actually converges for increasing <script type="math/tex">n</script>, we can run the following code (using the function defined above):</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">require</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">require</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w"> </span><span class="c1"># For nicer axis labels</span><span class="w">

</span><span class="c1"># Number of simulations for each value of n</span><span class="w">
</span><span class="n">nSimulations</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">

</span><span class="c1"># generate sequence 1, 2, ..., 9, 10, 20, ..., 90, 100, 200, ..., 900, 1000, ..., 90 000</span><span class="w">
</span><span class="n">Ns</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">9</span><span class="p">)</span><span class="w"> </span><span class="o">%o%</span><span class="w"> </span><span class="m">10</span><span class="o">^</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">4</span><span class="p">))</span><span class="w">

</span><span class="c1"># Run simulation for different n's</span><span class="w">
</span><span class="n">frac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">mclapply</span><span class="p">(</span><span class="n">Ns</span><span class="p">,</span><span class="w"> </span><span class="n">runSimulation</span><span class="p">,</span><span class="w"> </span><span class="n">mc.cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">23</span><span class="p">))</span><span class="w">

</span><span class="c1"># Zip</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ns</span><span class="p">,</span><span class="w"> </span><span class="n">frac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frac</span><span class="p">)</span><span class="w">

</span><span class="c1"># Average of the last 10 values, for convergence line</span><span class="w">
</span><span class="n">convergeVal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">frac</span><span class="p">[(</span><span class="nf">length</span><span class="p">(</span><span class="n">frac</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">frac</span><span class="p">)]),</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">

</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frac</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">2.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_log10</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="o">^</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comma</span><span class="p">,</span><span class="w"> </span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1.2e5</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">convergeVal</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comma</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"fraction of unique values"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code></pre></figure>

<!--- %* -->
<p>Note that I run this code on a multicore system, since the computation on a single core would require a lot of time. The result of the above code is shown in the following graph:</p>

<p><img src="https://MarkusThill.github.io/images/convergenceSampling.png" alt="Picture description" class="image-center" /></p>

<p>Obviously, for a training set and sample size of <script type="math/tex">n=1</script>, for 100% of the cases we have one unique value. As we can see, for larger <script type="math/tex">n</script> the curve converges to the value 0.6321, which might already appear familiar to you (e.g., from some problems in physics). We will see later, where this value comes from.</p>

<p>After performing several simulations we can now calculate the expected number of unique examples, for which one can proceed as follows:
First we define a random variable <script type="math/tex">X_i</script>, <script type="math/tex">i \in \{1,\ldots, n \}</script> which defines the events “example <script type="math/tex">i</script> was <script type="math/tex">(X_i=1)</script> / was not <script type="math/tex">(X_i=0)</script> selected by the sampling process”. Based on the probability of these events, we can formulate an expected value for each individual which shows how many times an example is selected on average:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
	E[X_i] 	&= 0\cdot P(X_i=0) + 1\cdot P(X_i=1) \\
			&= P(X_i=1) \\
			&= 1- P(X_i=0)
\end{align} %]]></script>

<p>The probability <script type="math/tex">P(X_i=0)</script> can be computed easier than <script type="math/tex">P(X_i=1)</script>. Since we sample the set <script type="math/tex">n</script> times, the probability of not selecting element <script type="math/tex">i</script> in any step is:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
	P(X_i=0) &= \Big(\frac{n-1}{n}\Big)^n
\end{align} %]]></script>

<p>The complementary probability function <script type="math/tex">P(X_i=1)</script> expresses how likely it is to draw an example at least once from the set. This is described with:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
	E[X_i]	&= 1- P(X_i=0) \\
			&= 1- \Big(\frac{n-1}{n}\Big)^n
\end{align} %]]></script>

<p>If we have <script type="math/tex">n</script> individuals in the set, we can expect to have the following number of unique examples in the sample. The random variable <script type="math/tex">Y</script> describes the number of unique items in one sample of size <script type="math/tex">n</script>:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
	E[Y] &= E \Bigg[ \sum_{i=1}^n X_i\Bigg] \\
		 &=  \sum_{i=1}^n E \big[X_i\big] \\ 	
		 &=  \sum_{i=1}^n  \Bigg(1- \Big(\frac{n-1}{n}\Big)^n\Bigg) \\
		 &=  n -  n\Big(\frac{n-1}{n}\Big)^n \\
		 &=  n -  \frac{(n-1)^n}{n^{n-1}}
\end{align} %]]></script>

<p>It is also possible to compute the fraction of the unique examples of the whole sample:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
	E[Y_\%] &= \frac{E[Y]}{m}\\  
			&= \frac{n -  \frac{(n-1)^n}{n^{n-1}}}{n} \\
			&= 1- \frac{(n-1)^n}{n\cdot n^{n-1}} \\
			&= 1- \frac{(n-1)^n}{n^{n}} \\
			&= 1- \Big(\frac{n-1}{n}\Big)^n \\
			&= 1- \Big(1-\frac{1}{n}\Big)^n
\end{align} %]]></script>

<p>Interestingly, for large <script type="math/tex">n</script>, this series converges to:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
	\lim_{n \to \infty} E[Y_\%] &= \lim_{n \to \infty} 1- \Big(1-\frac{1}{n}\Big)^n \\
								&= 1 - \exp (-1) \\
								&\approx 0.6321206
\end{align} %]]></script>

<p>Hence, random forests leave out <script type="math/tex">\frac{1}{\mbox{e}}</script> of the cases in the training sample, which are then used later for a so called out-of-bag (OOB) error estimate.</p>

      <footer class="entry-meta">
        <span class="entry-tags"></span>
        <span>Updated on <span class="entry-date date updated"><time datetime="2017-10-04 19:37:32 +0200">October 04, 2017</time></span></span>
        
        <span class="author vcard"><span class="fn">Markus Thill</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=https://MarkusThill.github.io/stats/ml/gsampling-with-replacement-random-forest/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=https://MarkusThill.github.io/stats/ml/gsampling-with-replacement-random-forest/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=https://MarkusThill.github.io/stats/ml/gsampling-with-replacement-random-forest/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->

      </footer>
    </div><!-- /.entry-content -->
    <div class="read-more">
  <div class="read-more-header">
    <a href="https://MarkusThill.github.io/markus" class="read-more-btn">About the Author</a>
  </div><!-- /.read-more-header -->
  <div class="read-more-content author-info">
    <h3>Markus Thill</h3>
    <div class="author-container">
      <img class="author-img" src="https://MarkusThill.github.io/images/avatar.jpg" alt="Markus Thill" />
      <div class="author-bio">I studied computer engineering (B.Sc.) and Automation & IT (M.Eng.). Generally, I am interested in machine learning (ML) approaches (in the broadest sense), but particularly in the fields of time series analysis, anomaly detection, Reinforcement Learning (e.g. for board games), Deep Learning (DL) and incremental (on-line) learning procedures. </div>
    </div>
    <div class="author-share">
      <ul class="list-inline social-buttons">
        
          <li><a href="https://github.com/markusthill" target="_blank"><i class="fa fa-github fa-fw"></i></a></li>
        
          <li><a href="https://www.linkedin.com/in/markus-thill-a4991090/" target="_blank"><i class="fa fa-linkedin fa-fw"></i></a></li>
        
      </ul>
      
        <a aria-label="Follow @MarkusThill on GitHub" data-size="large" href="https://github.com/MarkusThill" class="github-button">Follow @MarkusThill</a>
      
      <br>
      
    </div>
  </div>
</div>

    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="https://MarkusThill.github.io/stats/ml/gradient-softmax-function-with-cross-entropy/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="https://MarkusThill.github.io/deriving-a-closed-form-solution-of-the-fibonacci-sequence/" title="Deriving a Closed-Form Solution of the Fibonacci Sequence using the Z-Transform">Deriving a Closed-Form Solution of the Fibonacci Sequence using the Z-Transform</a></h3>
      <p>The Fibonacci sequence might be one of the most famous sequences in the field of mathmatics and computer science. Already high school stu...&hellip; <a href="https://MarkusThill.github.io/deriving-a-closed-form-solution-of-the-fibonacci-sequence/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="https://MarkusThill.github.io/derivation-of-a-weighted-recursive-least-squares-estimator/" title="Derivation of a Weighted Recursive Linear Least Squares Estimator">Derivation of a Weighted Recursive Linear Least Squares Estimator</a></h4>
        <span>Published on May 05, 2019</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="https://MarkusThill.github.io/gaussian-distribution-with-a-diagonal-covariance-matrix/" title="Gaussian Distribution With a Diagonal Covariance Matrix">Gaussian Distribution With a Diagonal Covariance Matrix</a></h4>
        <span>Published on May 04, 2019</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">window.jQuery || document.write('<script type="text/javascript" src="https://MarkusThill.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script type="text/javascript" src="https://MarkusThill.github.io/assets/js/scripts.min.js"></script>
<script type="text/javascript" async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
<script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^https:/.test(d.location)?'https':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>



<!-- Asynchronous Google Analytics snippet -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-113918188-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'markusthill-github-io'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




<script type="text/javascript">
    sharing();
</script>



<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2019 Markus Thill. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://github.com/aron-bordin/neo-hpstr-jekyll-theme" rel="nofollow">Neo-HPSTR Theme</a>.</span>

  </footer>
</div><!-- /.footer-wrapper -->

</body>
</html>
